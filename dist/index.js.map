{"version":3,"sources":["../src/index.ts"],"sourcesContent":["#!/usr/bin/env node\nimport tsup from \"tsup\";\nimport crypto from \"node:crypto\";\nimport { $, path, fs, argv, chalk } from \"zx\";\n\nconst id = crypto.randomBytes(6).toString(\"hex\");\nconst dir = path.resolve(process.cwd(), `.tzx-${id}`);\nconst args = process.argv.slice(3);\n\nconst clean = () => {\n  try {\n    fs.rmSync(dir, { recursive: true });\n  } catch {}\n};\n\nprocess.on(\"SIGINT\", clean);\nprocess.on(\"SIGTERM\", clean);\n\ntry {\n  let input = argv._[0];\n  if (!input) {\n    console.log(chalk.red(\"\\n[Error]\"));\n    console.log(`No file specified`);\n    process.exit(1);\n  }\n\n  if (!input.includes(\".\")) input += \".tz\";\n\n  const output = path.resolve(dir, input.replace(\".ts\", \".js\"));\n  const outputPKG = path.resolve(dir, `package.json`);\n  const outputTSConfig = path.resolve(dir, `tsconfig.json`);\n\n  await $`rm -rf ${dir}`.quiet();\n  await $`mkdir -p ${dir}`.quiet();\n  await $`cp ${input} ${dir}/${input}`.quiet();\n\n  await fs.writeJSON(outputPKG, {\n    name: \"__tmp_script__\",\n    version: \"1.0.0\",\n    type: \"module\",\n  });\n  await fs.writeJSON(outputTSConfig, {});\n\n  await tsup.build({\n    config: false,\n    entry: [`${dir}/${input}`],\n    outDir: dir,\n    format: \"esm\",\n    target: \"node16\",\n    platform: \"node\",\n    skipNodeModulesBundle: true,\n    splitting: false,\n    silent: true,\n    noExternal: [/.*/],\n    outExtension: () => ({ js: \".js\" }),\n  });\n\n  const content = await fs.readFile(output, \"utf8\");\n  const updated = content.replace(/^import.*(\"|')zx(\";|';|\"|')/gm, \"\");\n  await fs.writeFile(output, updated);\n\n  try {\n    await $`zx ${output} ${args}`.pipe(process.stdout); // .stdio(\"inherit\");\n  } catch {}\n\n  clean();\n} catch (e) {\n  clean();\n  console.error(e);\n  process.exit(1);\n}\n"],"mappings":";;;AACA,OAAO,UAAU;AACjB,OAAO,YAAY;AACnB,SAAS,GAAG,MAAM,IAAI,MAAM,aAAa;AAEzC,IAAM,KAAK,OAAO,YAAY,CAAC,EAAE,SAAS,KAAK;AAC/C,IAAM,MAAM,KAAK,QAAQ,QAAQ,IAAI,GAAG,QAAQ,IAAI;AACpD,IAAM,OAAO,QAAQ,KAAK,MAAM,CAAC;AAEjC,IAAM,QAAQ,MAAM;AAClB,MAAI;AACF,OAAG,OAAO,KAAK,EAAE,WAAW,KAAK,CAAC;AAAA,EACpC,QAAE;AAAA,EAAO;AACX;AAEA,QAAQ,GAAG,UAAU,KAAK;AAC1B,QAAQ,GAAG,WAAW,KAAK;AAE3B,IAAI;AACF,MAAI,QAAQ,KAAK,EAAE;AACnB,MAAI,CAAC,OAAO;AACV,YAAQ,IAAI,MAAM,IAAI,WAAW,CAAC;AAClC,YAAQ,IAAI,mBAAmB;AAC/B,YAAQ,KAAK,CAAC;AAAA,EAChB;AAEA,MAAI,CAAC,MAAM,SAAS,GAAG;AAAG,aAAS;AAEnC,QAAM,SAAS,KAAK,QAAQ,KAAK,MAAM,QAAQ,OAAO,KAAK,CAAC;AAC5D,QAAM,YAAY,KAAK,QAAQ,KAAK,cAAc;AAClD,QAAM,iBAAiB,KAAK,QAAQ,KAAK,eAAe;AAExD,QAAM,WAAW,MAAM,MAAM;AAC7B,QAAM,aAAa,MAAM,MAAM;AAC/B,QAAM,OAAO,SAAS,OAAO,QAAQ,MAAM;AAE3C,QAAM,GAAG,UAAU,WAAW;AAAA,IAC5B,MAAM;AAAA,IACN,SAAS;AAAA,IACT,MAAM;AAAA,EACR,CAAC;AACD,QAAM,GAAG,UAAU,gBAAgB,CAAC,CAAC;AAErC,QAAM,KAAK,MAAM;AAAA,IACf,QAAQ;AAAA,IACR,OAAO,CAAC,GAAG,OAAO,OAAO;AAAA,IACzB,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,uBAAuB;AAAA,IACvB,WAAW;AAAA,IACX,QAAQ;AAAA,IACR,YAAY,CAAC,IAAI;AAAA,IACjB,cAAc,OAAO,EAAE,IAAI,MAAM;AAAA,EACnC,CAAC;AAED,QAAM,UAAU,MAAM,GAAG,SAAS,QAAQ,MAAM;AAChD,QAAM,UAAU,QAAQ,QAAQ,iCAAiC,EAAE;AACnE,QAAM,GAAG,UAAU,QAAQ,OAAO;AAElC,MAAI;AACF,UAAM,OAAO,UAAU,OAAO,KAAK,QAAQ,MAAM;AAAA,EACnD,QAAE;AAAA,EAAO;AAET,QAAM;AACR,SAAS,GAAP;AACA,QAAM;AACN,UAAQ,MAAM,CAAC;AACf,UAAQ,KAAK,CAAC;AAChB;","names":[]}